VidillionUtil={functionDelegate:function(a,b){return function(){return b.apply(a,arguments)}},functionEmpty:function(){return function(){}},trim:function(a){return a.replace(/^\s+|\s+$/g,"")},forEach:function(a,b,c){for(var d=0,e=a.length;d<e;d++)b.call(c,a[d],d,a)},forEachProp:function(a,b,c){for(var d in a)b.call(c,a[d],d)},toQuery:function(a){var b=[];VidillionUtil.forEachProp(a,function(a,d){b.push(d+"="+a)});return b.join("&")},addParams:function(a,b){return b=={}?a+"":a+(-1==a.indexOf("?")?
"?":"&")+VidillionUtil.toQuery(b)}};var VidillionAjaxRequest=function(a,b,c,d){this.url=a||null;this.method=b||"GET";this.callback=c||null;this.params=d||null;this.xhr=null;this.initialize();this.url&&this.execute()};
VidillionAjaxRequest.prototype={initialize:function(){this.xhr=new XMLHttpRequest},execute:function(a,b,c,d){this.url=a||this.url;this.method=b||this.method;this.callback=c||this.callback;this.params=d||this.params;this.xhr.onreadystatechange=VidillionUtil.functionDelegate(this,function(){4===this.xhr.readyState&&this.callback&&this.callback.call(this,this.xhr.responseText,this.xhr.status)});this.xhr.open(this.method,null!=this.params?VidillionUtil.addParams(this.url,this.params):this.url,!0);this.xhr.setRequestHeader("Content-Type",
"application/x-www-form-urlencoded");this.xhr.send()}};var VidillionXMLParser=function(a){this.xmlString=a||null;this.parser=new DOMParser;this.xmlDoc=null;this.xmlString&&this.load()};
VidillionXMLParser.prototype={load:function(a){this.xmlString=a||this.xmlString;this.xmlDoc=this.parser.parseFromString(this.xmlString,"text/xml")},getEntries:function(){for(var a=[],b=this.xmlDoc.documentElement.firstChild;b;){var c=b.getAttribute("type");a.push(new DAGContentEntry(c,b.firstChild.textContent));b=b.nextSibling}return a},isValidXML:function(a){return null==this.xmlDoc?!1:0!=this.xmlDoc.documentElement.childNodes.length}};
DAGUtil={getStickyDAGUrl:function(a,b){new VidillionAjaxRequest("https://dag.total-stream.net/info/showstickydag","GET",VidillionUtil.functionDelegate(this,function(a,d){b&&b.call(this,a)}),{uid:a.uid})},vidillionSDKInfo:function(){return"dag_js_tvos_sdk_1.0"},normalizedContentURL:function(a,b){var c={};c.uid=b.uid;c.cid=b.cid;c.sid=b.sid;c.appid=Device.appIdentifier;c.name=b.name||"";c.ver=Device.appVersion;c.os="tvos";c.osv=Device.systemVersion;c.make="apple";c.model=Device.model;c.dt=3;c.auth=
b.auth||"";c.vsdk=DAGUtil.vidillionSDKInfo();c=VidillionUtil.addParams(a,c);return encodeURI(c)},MEDIA_ERR_ABORTED:1,MEDIA_ERR_NETWORK:2,MEDIA_ERR_DECODE:3,MEDIA_ERR_SRC_NOT_SUPPORTED:4};DAGContentEntry=function(a,b){this.type=a||"";this.url=b||""};DAGContentEntry.DAG_CONTENT_ENTRY_TYPE_TRACKER="tracker";DAGContentEntry.DAG_CONTENT_ENTRY_TYPE_AD="ad";DAGContentEntry.prototype={setType:function(a){this.type=a},getType:function(){return this.type},setUrl:function(a){this.url=a},getUrl:function(){return this.url}};
DAGJSTVOSSDK=function(a){this.options=a;this.playerElement=null;this.contentEntries=[];this.playContent=this.playAd=this.stickyDAGHostname=null};DAGJSTVOSSDK.EXCEPTION_GENERAL_ERROR=0;
DAGJSTVOSSDK.prototype={redrawPlayer:function(){this.playerElement=new Player;this.playerElement.playlist=new Playlist;this.playerElement.addEventListener("mediaItemWillChange",VidillionUtil.functionDelegate(this,function(a){1===a.reason&&this.playNext()}));this.playerElement.addEventListener("requestSeekToTime",VidillionUtil.functionDelegate(this,function(a){a=this.contentEntries[this.contentCursor].getType();return a!=DAGContentEntry.DAG_CONTENT_ENTRY_TYPE_AD&&a!=DAGContentEntry.DAG_CONTENT_ENTRY_TYPE_TRACKER}))},
play:function(a,b){this.playAd=a;this.playContent=b;this.loadContent(VidillionUtil.functionDelegate(this,function(){this.playNext()}))},playNext:function(){this.contentCursor+=1;if(this.contentEntries.length==this.contentCursor)return!1;var a=this.contentEntries[this.contentCursor];if(a.getType())switch(a.getType()){case DAGContentEntry.DAG_CONTENT_ENTRY_TYPE_TRACKER:new VidillionAjaxRequest(a.getUrl(),"GET",null,{uid:this.options.uid});this.playNext();break;case DAGContentEntry.DAG_CONTENT_ENTRY_TYPE_AD:this.playAd?
this.playAd.call(this,a.getUrl()):(this.redrawPlayer(),this.playerElement.playlist.push(new MediaItem("video",a.getUrl())),this.playerElement.present());break;default:this.playContent?this.playContent.call(this,a.getUrl()):(this.redrawPlayer(),this.playerElement.playlist.push(new MediaItem("video",a.getUrl())),this.playerElement.present())}},loadContent:function(a){var b=function(b,c){this.contentEntries=[];if(200==c){var d=new VidillionXMLParser(b);if(d.isValidXML("/DAGPlaylist"))this.contentEntries=
d.getEntries();else throw DAGJSTVOSSDK.EXCEPTION_GENERAL_ERROR;this.contentCursor=-1}else throw DAGJSTVOSSDK.EXCEPTION_GENERAL_ERROR;a&&a.call(this)},c=function(){new VidillionAjaxRequest(DAGUtil.normalizedContentURL("https://"+this.stickyDAGHostname+"/dag1.xml",this.options),"GET",VidillionUtil.functionDelegate(this,b),{uid:this.options.uid})},d=function(a){this.stickyDAGHostname=a;c.call(this)};this.stickyDAGHostname?c.call(this):DAGUtil.getStickyDAGUrl(this,VidillionUtil.functionDelegate(this,
d))},getNext:function(){this.contentCursor+=1;if(this.contentEntries.length==this.contentCursor)return!1;var a=this.contentEntries[this.contentCursor];return a.getType()==DAGContentEntry.DAG_CONTENT_ENTRY_TYPE_TRACKER?(new VidillionAjaxRequest(a.getUrl(),"GET",null,{uid:this.options.uid}),this.getNext()):a}};
